# ‚öôÔ∏è Configuration Guide

Simple guide to configuring the fraud monitoring system.

## Quick Setup

1. **Copy the example**: `cp env.example .env`
2. **Edit required settings**: `nano .env`
3. **Generate secrets**: `python scripts/generate_keys.py`
4. **Start system**: `docker-compose up -d`

## Required Settings

These **must** be configured for the system to work:

```bash
# Telegram Bot (get from @BotFather)
TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz

# Groups to monitor (negative numbers)
TELEGRAM_GROUP_IDS=-1001234567890,-1001234567891

# Database password (generated automatically)
DB_PASSWORD=your_secure_password_here
```

## Optional Settings

These have sensible defaults but can be customized:

```bash
# Brand keywords to monitor
BRAND_KEYWORDS=visa,mastercard,paypal,stripe,amazon

# Logging level
LOG_LEVEL=INFO

# OCR settings
OCR_LANGUAGES=eng
OCR_CONFIDENCE_THRESHOLD=60

# Rate limiting
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW=3600

## Configuration Categories

### ü§ñ Telegram Settings

| Setting | Description | Example |
|---------|-------------|---------|
| `TELEGRAM_BOT_TOKEN` | Bot token from @BotFather | `1234567890:ABC...` |
| `TELEGRAM_GROUP_IDS` | Comma-separated group IDs | `-1001234567890` |

**Getting Group IDs:**
1. Add bot to your group
2. Send a test message
3. Check logs for group ID (negative number)

### üîê Security Settings

| Setting | Description | How to Generate |
|---------|-------------|-----------------|
| `DB_PASSWORD` | Database password (8+ chars) | Auto-generated by setup script |

### üéØ Detection Settings

| Setting | Default | Description |
|---------|---------|-------------|
| `BRAND_KEYWORDS` | `visa,mastercard,paypal,stripe` | Brands to monitor |
| `OCR_CONFIDENCE_THRESHOLD` | `60` | Minimum OCR confidence (0-100) |

### üìä System Settings

| Setting | Default | Description |
|---------|---------|-------------|
| `LOG_LEVEL` | `INFO` | `DEBUG`, `INFO`, `WARNING`, `ERROR` |
| `RATE_LIMIT_REQUESTS` | `100` | Max requests per window |
| `RATE_LIMIT_WINDOW` | `3600` | Rate limit window (seconds) |

## Using Configuration in Code

```python
from src.config import settings

# Access any setting
bot_token = settings.telegram_bot_token
keywords = settings.keywords_list  # Returns list
groups = settings.telegram_groups  # Returns list of integers

# Settings are automatically validated
# - Bot token must be 10+ characters
# - Group IDs must start with "-"
# - Secret keys must be 32+ characters
```

## Environment Loading

The system loads configuration from:

1. **Environment variables** (highest priority)
2. **Docker Compose environment section**
3. **`.env` file** (for local development)

### Docker Compose Example
```yaml
services:
  app:
    environment:
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - DATABASE_URL=postgresql://fraud_monitor:${DB_PASSWORD}@db:5432/fraud_monitor_db
    env_file:
      - .env
```

## Security Best Practices

### ‚úÖ Do This
- Generate strong random keys using the provided scripts
- Use different keys for dev/staging/production
- Keep `.env` files out of version control
- Rotate keys regularly
- Use environment variables in production

### ‚ùå Don't Do This
- Commit secrets to git
- Use default or weak passwords
- Share keys between environments
- Hard-code sensitive values

## Validation & Errors

The system validates all settings on startup:

**Common Errors:**
```bash
# Missing required setting
ValidationError: TELEGRAM_BOT_TOKEN is required

# Invalid group ID format
ValidationError: Invalid group ID format: 1234567890 (must start with -)

# Weak database password
ValidationError: DB_PASSWORD must be at least 8 characters

# Invalid log level
ValidationError: LOG_LEVEL must be DEBUG, INFO, WARNING, ERROR, or CRITICAL
```

## Troubleshooting

### Bot Not Working
- ‚úÖ Check `TELEGRAM_BOT_TOKEN` is correct
- ‚úÖ Verify bot is added to target groups
- ‚úÖ Ensure group IDs are negative numbers
- ‚úÖ Check bot has message reading permissions

### Database Errors
- ‚úÖ Verify `DB_PASSWORD` matches Docker Compose
- ‚úÖ Check `DATABASE_URL` format
- ‚úÖ Ensure database container is running

### Configuration Not Loading
- ‚úÖ Check `.env` file exists and is readable
- ‚úÖ Verify environment variables are set
- ‚úÖ Look for validation errors in startup logs

---

**üí° Pro Tip**: Use `docker-compose logs app | grep -i error` to quickly find configuration issues.